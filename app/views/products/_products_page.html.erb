<h1>Products</h1>
<%= @user_id %>
<div class="menu-container">
    <div class="row"> 
    <%# #style="display: grid; grid-template-columns: 73% 27%; %>
      <div class="col-12 input-group">
        <%= form_tag(products_path, method: :post) do %>

          <div class="input-group  mb-5">
            <div class="col-4" style="padding:0">
              <%= select_tag :category_id, options_for_select(Category.all.collect { |c| [c.category_name, c.id]}, @category.try(:id)), class: 'form-control', prompt: 'Select category' %>
              <%# <%= select_tag :category_id, options_for_select(Category.all.collect { |c| [c.category_name, c.id]}, @category_id), class: 'form-control', prompt: 'Select category'%> 
            </div>
            <div class="col-3" style="padding:0">
              <%= text_field_tag(:price_from, @price_from, class:'form-control', placeholder: 'Price from...')%>
            </div>
            <div class="col-3" style="padding:0">
              <%= text_field_tag(:price_to, @price_to, class:'form-control', placeholder: 'Price to...')%>
            </div>

            <div class="col-2" style="padding:0">
              <%= submit_tag 'Filter out', class: 'btn btn-dark'%>
            </div>
          </div>
        <% end %>
      </div> 

      <% if @category.present? %>
        <h2><%= @category.category_name %></h2>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Description</th>
              <th scope="col">Price</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <% @category.products.each do |product| %>
              <tr>
                <td><%= product.name %></td>
                <td><%= product.description %></td>
                <td><%= number_to_currency(product.price) %></td>
                <td>
                  <%= form_for(current_cart.product_items.build(product: product), remote: true) do |f| %>
                    <%= f.number_field :quantity, value: 1, min: 1 %>
                    <%= f.hidden_field :product_id, value: product.id %>
                    <%= f.submit 'Add to Cart', data: {toggle: 'modal', target: '#cart_modal'} %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        <% else %>
          <% @categories.each do |category| %>
          <h2><%= category.category_name %></h2>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Description</th>
                  <th scope="col">Price</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <% category.products.each do |product| %>
                  <tr>
                    <td><%= product.name %></td>
                    <td><%= product.description %></td>
                    <td><%= number_to_currency(product.price) %></td>
                    <%# <td data-toggle="modal" data-target="#cart_modal"><%= button_to 'Add to Cart', product_items_path(product_id: product.id), 
                      remote: true %>
                    <td>
                      <%= form_for(current_cart.product_items.build(product: product), remote: true) do |f| %>
                        <%= f.number_field :quantity, value: 1, min: 1 %>
                        <%= f.hidden_field :product_id, value: product.id %>
                        <%= f.submit 'Add to Cart', data: {toggle: 'modal', target: '#cart_modal'} %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% end %>
      <% end %>
    </div>
  </div>
     
<!-- Modal -->
<div class="modal fade" id="cart_modal" tabindex="-1" role="dialog" aria-labelledby="cart_modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
      <div class="cart_title modal-title" id="cart_modalLabel"><h1>Your Cart<h1></div> 
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id='cart'>
         <%= render @cart %>
      </div>
      <div class="modal-footer">
        <%# <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>  %>
        <%= button_to 'Remove cart', @cart, method: :delete, confirm: 'Are you sure?', class: "btn btn-secondary" %>
        <%# <button type="button" class="btn btn-primary">Save changes</button> %>
        <%= button_to 'To Order', new_order_path, method: :get, class: "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
          


  